import{r as a,m as o,n as k,A as N,j as e,C as v}from"./index-C7pVrS_7.js";import{C as d}from"./index.es-glSb0DD9.js";import{e as I}from"./icons8-error-EK1qFjAG.js";import{a as A,b as i}from"./CContainer-PhEzx4hZ.js";import{C as u,a as c}from"./CRow-CPZ9ohDV.js";import{C as L}from"./CCardGroup-DAOtAwUB.js";import{C as M,a as U}from"./CCardBody-B_fQyIRu.js";import{C as B}from"./CAlert-BYKSY1R6.js";import{C as E}from"./CImage-DeHz2zLz.js";import{C as F}from"./CForm-B6jtVr0j.js";import{C as x,a as h}from"./CInputGroupText-C2W2N9iV.js";import{c as P}from"./cil-user-Ddrdy7PS.js";import{C as g}from"./CFormInput-D2ddT9aL.js";import{c as R}from"./cil-lock-locked-DmxpJbVL.js";import"./CCloseButton-BpyeHNSr.js";import"./CFormControlWrapper-BORlAwN8.js";import"./CFormControlValidation-B0znXVuH.js";import"./CFormLabel-1hmlyx2z.js";const re=()=>{const[l,C]=a.useState(""),[p,f]=a.useState(""),m=o.get("responseMessage"),[j,n]=a.useState(!1),y=k(),{setRole:b,setUsername:S,setAuthToken:w}=a.useContext(N),T=async r=>{r.preventDefault(),n(!0);try{const t=await fetch("http://localhost:8080/auth/authenticate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,password:p})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json();console.log(s),n(!1),b(s.role),S(s.user),w({accessToken:s.accessToken,refreshToken:s.refreshToken}),o.set("username",s.user,{expires:7,secure:!0,sameSite:"Strict",path:"/"}),o.set("role",s.role,{expires:7,secure:!0,sameSite:"Strict",path:"/"}),o.set("refreshToken",s.accessToken,{expires:7,secure:!0,sameSite:"Strict",path:"/"}),o.set("responseMessage",s.responseMessage,{expires:7,secure:!0,sameSite:"Strict",path:"/"})}catch(t){console.error("There was a problem with the fetch operation:",t),n(!1)}y("/dashboard")};return e.jsx("div",{className:"min-vh-100 d-flex flex-row align-items-center",style:{backgroundImage:"url('src/assets/images/login-bg.jpg')",backgroundRepeat:"no-repeat",backgroundColor:"rgba(0,0,0,0.5)",backgroundSize:"cover",backgroundBlendMode:"multiply",overflow:"hidden"},children:e.jsx(A,{children:e.jsx(u,{className:"justify-content-center",children:e.jsxs(c,{md:4,children:[e.jsx("h3",{style:{textAlign:"center",color:"#fff",padding:"20px"},children:"WAZI MOBILE"}),e.jsx(L,{children:e.jsx(M,{className:"p-4",style:{boxShadow:"0px 15px 34px 0px rgba(0,0,0,0.2)"},children:e.jsxs(U,{children:[m=="Login Failed"?e.jsxs(B,{color:"danger",style:{textAlign:"center"},children:[e.jsx(E,{src:I,height:50}),e.jsx("h5",{style:{margin:"4px 0px"},children:m}),e.jsx("p",{style:{margin:"0"},children:"Wrong username or password. Try again"})]}):null,e.jsxs(F,{onSubmit:T,style:{textAlign:"center"},children:[e.jsx("h1",{style:{marginTop:"10px"},children:"Login"}),e.jsx("p",{className:"text-body-secondary",style:{marginTop:"10px"},children:"Sign In to your account"}),e.jsxs(x,{className:"mb-3",style:{marginTop:"20px"},children:[e.jsx(h,{style:{borderColor:"rgb(71, 71, 212)",backgroundColor:"rgb(71, 71, 212)",color:"#fff"},children:e.jsx(d,{icon:P})}),e.jsx(g,{placeholder:"Username",autoComplete:"username",value:l,onChange:r=>C(r.target.value),style:{borderColor:"rgb(71, 71, 212)"},required:!0})]}),e.jsxs(x,{className:"mb-4",children:[e.jsx(h,{style:{borderColor:"rgb(71, 71, 212)",backgroundColor:"rgb(71, 71, 212)",color:"#fff"},children:e.jsx(d,{icon:R})}),e.jsx(g,{type:"password",placeholder:"Password",autoComplete:"current-password",value:p,onChange:r=>f(r.target.value),required:!0,style:{borderColor:"rgb(71, 71, 212)"}})]}),e.jsxs(u,{children:[e.jsx(c,{xs:12,style:{marginTop:"15px"},children:j?e.jsxs(i,{color:"success",type:"submit",className:"px-4",disabled:!0,style:{width:"100%"},children:[e.jsx(v,{as:"span",size:"sm"})," authenticating ..."]}):e.jsx(i,{color:"primary",className:"px-4",type:"submit",style:{width:"100%"},children:"Login"})}),e.jsx(c,{xs:12,className:"text-right",style:{marginTop:"15px"},children:e.jsx(i,{color:"link",className:"px-0",children:"Forgot password?"})})]})]})]})})})]})})})})};export{re as default};
